{# templates/feed/partials/_post.html #}
<div class="post card" style="width:80%; margin: 16px auto;">
  {# Row 1: avatar + name + text (clamped) #}
  <div class="post-header">
    <div class="avatar-sm">
      {% if post.author.avatar %}
        <img src="{{ post.author.avatar.url }}" alt="avatar">
      {% else %}
        <div class="avatar-placeholder"></div>
      {% endif %}
    </div>
    <div class="post-meta">
      <div class="username">@{{ post.author.username }}</div>
      {% if post.text %}
        <div class="post-text clamp-5" data-post-id="{{ post.id }}">
          {{ post.text|linebreaksbr }}
        </div>
        <button type="button" class="linklike read-more" data-target="{{ post.id }}" hidden>Read more</button>
      {% endif %}
    </div>
  </div>

  {# Row 2: media grid (1â€“3 cols) #}
  {% if post.media.all %}
    {% with media_list=post.media.all %}
    <div class="media-grid-wrap" data-post-id="{{ post.id }}">
      <div class="media-grid">
        {% for m in media_list %}
          {% if m.kind == 'photo' %}
            <div class="media-cell">
              <img src="{{ m.file.url }}" alt="photo">
            </div>
          {% else %}
            <div class="media-cell">
              <video controls preload="metadata">
                <source src="{{ m.file.url }}">
              </video>
            </div>
          {% endif %}
        {% endfor %}
      </div>
      {% if media_list|length > 6 %}
        <button type="button" class="linklike view-more" data-target="{{ post.id }}">View more</button>
      {% endif %}
    </div>
    {% endwith %}
  {% endif %}

  {# Row 3: actions #}
  <div class="post-actions">
    <button class="btn-ghost" type="button">Like</button>
    <button class="btn-ghost comment-toggle" type="button" data-target="{{ post.id }}">Comment</button>
    <button class="btn-ghost" type="button">Share</button>
  </div>

  {# Comments (collapsed until toggled) #}
  <div class="comments" id="comments-{{ post.id }}" hidden>
    <form action="{% url 'add_comment' post.id %}" method="post" class="comment-form">
      {% csrf_token %}
      <div class="avatar-sm">
        {% if request.user.avatar %}
          <img src="{{ request.user.avatar.url }}" alt="avatar">
        {% else %}
          <div class="avatar-placeholder"></div>
        {% endif %}
      </div>
      <textarea name="comment_text" rows="2" placeholder="Write a comment..." required></textarea>
      <button class="btn-primary" type="submit">Post</button>
    </form>

    {% for c in post.comments.all %}
      <div class="comment">
        <strong>@{{ c.author.username }}</strong> {{ c.text|linebreaksbr }}
      </div>
    {% endfor %}
  </div>
</div>
